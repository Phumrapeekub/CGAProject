{% extends "nurse/base.html" %}
{% block content %}

<div class="min-h-screen bg-gradient-to-br from-sky-50 via-white to-emerald-50 py-10">
  <div class="max-w-5xl mx-auto px-6">

    <div class="rounded-3xl bg-white shadow-2xl overflow-hidden border border-white/60">
      <!-- Header ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î -->
      <div class="bg-gradient-to-r from-cyan-400 to-emerald-400 px-8 py-7 text-white
                  flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center shadow-inner">
            <!-- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡πÜ -->
            <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M8 7V3m8 4V3M4 11h16M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl md:text-3xl font-bold leading-tight">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</h1>
            <p class="opacity-90">Comprehensive Geriatric Assessment (CGA)</p>
          </div>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
<a href="{{ url_for('nurse.dashboard') }}"
   class="inline-flex items-center gap-2 rounded-2xl px-4 py-2
          bg-white/20 hover:bg-white/30
          text-white font-semibold transition shadow-sm">
  üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
</a>

      </div>

      <!-- Body -->
      <div class="p-8 md:p-10">

  {# =========================
     1) ERROR ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ flash)
     ‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å backend: page_errors (list) ‡∏´‡∏£‡∏∑‡∏≠ error_patient_list (string)
     ========================= #}
  {% if page_errors %}
    <div class="mb-6 space-y-2">
      {% for message in page_errors %}
        <div class="rounded-2xl px-4 py-3 text-sm bg-rose-50 text-rose-800 border border-rose-200">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% elif error_patient_list %}
    <div class="mb-6">
      <div class="rounded-2xl px-4 py-3 text-sm bg-rose-50 text-rose-800 border border-rose-200">
        {{ error_patient_list }}
      </div>
    </div>
  {% endif %}

  {# =========================
     2) FLASH ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÄ‡∏ä‡πà‡∏ô success ‡∏´‡∏•‡∏±‡∏á redirect)
     ‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡∏î‡πâ‡∏ß‡∏¢ unique filter (‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡∏∞‡∏™‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô)
     ========================= #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-6 space-y-2">
        {# ‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏ß‡πâ‡πÉ‡∏ô namespace #}
        {% set ns = namespace(seen=[]) %}
        {% for category, message in messages %}
          {% if message not in ns.seen %}
            {% set ns.seen = ns.seen + [message] %}
            <div class="rounded-2xl px-4 py-3 text-sm
                        {% if category == 'success' %} bg-emerald-50 text-emerald-800 border border-emerald-200
                        {% elif category == 'warning' %} bg-amber-50 text-amber-800 border border-amber-200
                        {% elif category == 'danger' %} bg-rose-50 text-rose-800 border border-rose-200
                        {% else %} bg-slate-50 text-slate-700 border border-slate-200
                        {% endif %}">
              {{ message }}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

        <form method="post" action="{{ url_for('nurse.assess_create') }}" class="space-y-6">
          <div>
            <label for="hn" class="block text-slate-700 font-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (HN)</label>
            <input id="hn" name="hn" value="{{ hn or '' }}" placeholder="‡∏Å‡∏£‡∏≠‡∏Å HN" autocomplete="off" required
                   class="w-full rounded-2xl border border-slate-200 px-5 py-3 outline-none bg-slate-50
                          focus:ring-4 focus:ring-blue-100 focus:border-blue-300">
          </div>

          <div>
            <label for="gcn" class="block text-slate-700 font-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (GCN)</label>
            <input id="gcn" name="gcn" value="{{ gcn or '' }}" placeholder="‡∏Å‡∏£‡∏≠‡∏Å GCN" autocomplete="off" required
                   class="w-full rounded-2xl border border-slate-200 px-5 py-3 outline-none bg-white
                          focus:ring-4 focus:ring-blue-100 focus:border-blue-300">
          </div>

          <div>
  <label class="block font-semibold text-gray-800 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</label>
  <input name="full_name"
         value="{{ form.full_name if form and form.full_name is defined else '' }}"
         class="w-full h-12 rounded-2xl border border-gray-200 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-200"
         placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
</div>


          <div class="pt-2 flex flex-col md:flex-row md:items-center gap-4">
            <button id="startBtn" type="submit"
                    class="pointer-events-none opacity-50 w-full md:w-auto
                           rounded-2xl px-10 py-3 font-bold text-white
                           bg-gradient-to-r from-blue-500 to-indigo-600
                           shadow-lg transition-all duration-200">
              ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
            </button>

            <p class="text-sm text-slate-500">
              ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç HN ‡πÅ‡∏•‡∏∞ GCN ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
            </p>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>

<script>
  const hn = document.getElementById("hn");
  const gcn = document.getElementById("gcn");
  const btn = document.getElementById("startBtn");

  function toggleBtn() {
    const ok = hn.value.trim().length > 0 && gcn.value.trim().length > 0;
    if (ok) {
      btn.classList.remove("pointer-events-none", "opacity-50");
      btn.classList.add("hover:opacity-95", "hover:-translate-y-0.5");
    } else {
      btn.classList.add("pointer-events-none", "opacity-50");
      btn.classList.remove("hover:opacity-95", "hover:-translate-y-0.5");
    }
  }

  hn.addEventListener("input", toggleBtn);
  gcn.addEventListener("input", toggleBtn);
  toggleBtn();
</script>

{% endblock %}
