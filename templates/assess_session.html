{% extends "base.html" %}
{% block title %}‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô | CGA{% endblock %}
{% block content %}

<div class="max-w-6xl mx-auto px-4 py-6 space-y-6">

  <!-- HN/GCN + ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2">
      <span class="px-4 py-1.5 rounded-full bg-white shadow border text-slate-700">
        <span class="font-medium">HN:</span> {{ hn }} <span class="mx-1">|</span>
        <span class="font-medium">GCN:</span> {{ gcn }}
      </span>
    </div>
    <span class="px-4 py-1.5 rounded-full bg-white shadow border text-slate-700">
      ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    </span>
  </div>

  <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô progress bar -->
  <div class="mt-4 flex justify-center">
    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white shadow-sm border border-slate-200 text-sm text-slate-600">
      <span>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà</span>
      <span class="font-semibold text-emerald-600">1</span>
      <span>‡∏à‡∏≤‡∏Å</span>
      <span class="font-semibold">3</span>
    </div>
  </div>

  <!-- üîπ Step Navigation -->
  <div class="mt-4 flex items-center justify-center gap-3">
    <!-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á submit -->
    <button type="button"
            class="px-4 py-2 rounded-full text-sm font-medium bg-blue-600 text-white">
      ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1
    </button>

    <!-- ‡πÑ‡∏õ step 2 -->
    <button type="submit"
            form="step1-form"
            name="goto_step"
            value="2"
            class="px-4 py-2 rounded-full text-sm font-medium bg-white border">
      ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2
    </button>

    <!-- ‡πÑ‡∏õ step 3 -->
    <button type="submit"
            form="step1-form"
            name="goto_step"
            value="3"
            class="px-4 py-2 rounded-full text-sm font-medium bg-white border">
      ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3
    </button>
  </div>

  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
  <div class="rounded-[26px] bg-white/95 backdrop-blur shadow-xl border border-slate-100 overflow-hidden">
    <div class="px-6 py-4 flex items-center gap-3 bg-sky-50">
      <div class="w-10 h-10 rounded-xl bg-sky-200 text-sky-700 grid place-items-center">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M5.5 20a6.5 6.5 0 0113 0M12 12a5 5 0 100-10 5 5 0 000 10z" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="font-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
    </div>

    <form id="step1-form"
          method="POST"
          action="{{ url_for('assess_session', hn=hn, gcn=gcn) }}"
          class="p-6 md:p-8 space-y-6">

      <!-- ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-slate-700 font-medium mb-2">
            ‡∏ä‡∏∑‡πà‡∏≠ <span class="text-rose-600">*</span>
          </label>
          <input type="text"
                 name="name"
                 value="{{ patient.name if patient else '' }}"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3">
        </div>

        <div>
          <label class="block text-slate-700 font-medium mb-2">
            ‡∏™‡∏Å‡∏∏‡∏• <span class="text-rose-600">*</span>
          </label>
          <input type="text"
                 name="surname"
                 value="{{ patient.surname if patient else '' }}"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3">
        </div>
      </div>

      <!-- ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î / ‡∏≠‡∏≤‡∏¢‡∏∏ / ‡πÄ‡∏û‡∏® -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
        <div>
          <label class="block text-slate-700 font-medium mb-2">
            ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î (‡∏û.‡∏®.) <span class="text-rose-600">*</span>
          </label>
          <input id="dob"
                 name="dob"
                 type="text"
                 data-buddhist-date="1"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                 value="{{ dob or '' }}">
          <input type="hidden" id="dob_ad" name="birthdate">
        </div>

        <div>
          <label class="block text-slate-700 font-medium mb-2">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
          <input id="age"
                 type="number"
                 name="age"
                 value="{{ patient.age if patient and patient.age else '' }}"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3">
        </div>
        
        <div>
          <label class="block text-slate-700 font-medium mb-2">
            ‡πÄ‡∏û‡∏® <span class="text-rose-600">*</span>
          </label>
          <div class="flex items-center gap-6 mt-3">
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="gender" value="‡∏ä‡∏≤‡∏¢"
                     class="accent-blue-600"
                     {% if patient and patient.gender == '‡∏ä‡∏≤‡∏¢' %}checked{% endif %}>
              ‡∏ä‡∏≤‡∏¢
            </label>

            <label class="inline-flex items-center gap-2">
              <input type="radio" name="gender" value="‡∏´‡∏ç‡∏¥‡∏á"
                     class="accent-blue-600"
                     {% if patient and patient.gender == '‡∏´‡∏ç‡∏¥‡∏á' %}checked{% endif %}>
              ‡∏´‡∏ç‡∏¥‡∏á
            </label>
          </div>
        </div>
      </div>

      <!-- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà -->
      <div>
        <label class="block text-slate-700 font-medium mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
        <input type="text"
               name="address"
               class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
               placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏´‡∏°‡∏π‡πà ‡∏ï‡∏≥‡∏ö‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"
               value="{{ patient.address if patient and patient.address else '' }}">
      </div>

      <!-- ‡πÇ‡∏ó‡∏£ + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏£‡∏™ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-slate-700 font-medium mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input type="text"
                 name="phone"
                 value="{{ patient.phone if patient and patient.phone else '' }}"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3">
        </div>

        <div>
          <label class="block text-slate-700 font-medium mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏£‡∏™</label>
          <div class="grid grid-cols-4 gap-4">
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="marry" value="‡πÇ‡∏™‡∏î"
                     class="accent-blue-600"
                     {% if patient and patient.marry == '‡πÇ‡∏™‡∏î' %}checked{% endif %}>
              ‡πÇ‡∏™‡∏î
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="marry" value="‡∏™‡∏°‡∏£‡∏™"
                     class="accent-blue-600"
                     {% if patient and patient.marry == '‡∏™‡∏°‡∏£‡∏™' %}checked{% endif %}>
              ‡∏™‡∏°‡∏£‡∏™
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="marry" value="‡∏´‡∏°‡πâ‡∏≤‡∏¢"
                     class="accent-blue-600"
                     {% if patient and patient.marry == '‡∏´‡∏°‡πâ‡∏≤‡∏¢' %}checked{% endif %}>
              ‡∏´‡∏°‡πâ‡∏≤‡∏¢
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="marry" value="‡∏´‡∏¢‡πà‡∏≤"
                     class="accent-blue-600"
                     {% if patient and patient.marry == '‡∏´‡∏¢‡πà‡∏≤' %}checked{% endif %}>
              ‡∏´‡∏¢‡πà‡∏≤
            </label>
          </div>
        </div>
      </div>

      <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô / ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-slate-700 font-medium mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢</label>
          <input type="number"
                 name="num_people"
                 class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                 placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•"
                 value="{{ patient.num_people if patient and patient.num_people else '' }}">
        </div>

        <div>
          <label class="block text-slate-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢</label>
          <div class="grid grid-cols-3 gap-4">
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="live" value="alone"
                     class="accent-blue-600"
                     {% if patient and patient.live == 'alone' %}checked{% endif %}>
              ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="live" value="family"
                     class="accent-blue-600"
                     {% if patient and patient.live == 'family' %}checked{% endif %}>
              ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="live" value="caregiver"
                     class="accent-blue-600"
                     {% if patient and patient.live == 'caregiver' %}checked{% endif %}>
              ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            </label>
          </div>
        </div>
      </div>

      <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á: ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° -->
      <div class="rounded-[26px] bg-white/95 backdrop-blur shadow-xl border border-slate-100 overflow-hidden">
        <div class="px-6 py-4 flex items-center gap-3 bg-rose-50">
          <div class="w-10 h-10 rounded-xl bg-rose-200 text-rose-700 grid place-items-center">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M12 8v8m4-4H8" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="font-semibold">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</div>
        </div>

        <div class="p-6 md:p-8 space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà -->
            <div>
              <label class="block text-slate-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</label>
              <div class="flex items-center gap-6">
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="smoke" value="no"
                         class="accent-blue-600"
                         {% if patient and patient.smoke == 'no' %}checked{% endif %}>
                  ‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ö
                </label>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="smoke" value="yes"
                         class="accent-blue-600"
                         {% if patient and patient.smoke == 'yes' %}checked{% endif %}>
                  ‡∏™‡∏π‡∏ö
                </label>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="smoke" value="quit"
                         class="accent-blue-600"
                         {% if patient and patient.smoke == 'quit' %}checked{% endif %}>
                  ‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß
                </label>
              </div>
            </div>

            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á -->
            <div>
              <label class="block text-slate-700 font-medium mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label>
              <input type="number"
                     name="height"
                     class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                     placeholder="160"
                     value="{{ patient.height_cm if patient and patient.height_cm else '' }}">
            </div>

            <!-- ‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå -->
            <div>
              <label class="block text-slate-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå</label>
              <div class="flex items-center gap-4">
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="alcohol" value="no"
                         class="accent-blue-600"
                         {% if patient and patient.alcohol == 'no' %}checked{% endif %}>
                  ‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏°
                </label>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="alcohol" value="sometimes"
                         class="accent-blue-600"
                         {% if patient and patient.alcohol == 'sometimes' %}checked{% endif %}>
                  ‡∏î‡∏∑‡πà‡∏°‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </label>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" name="alcohol" value="daily"
                         class="accent-blue-600"
                         {% if patient and patient.alcohol == 'daily' %}checked{% endif %}>
                  ‡∏î‡∏∑‡πà‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                </label>
              </div>
            </div>
          </div>

          <!-- ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å / ‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label class="block text-slate-700 font-medium mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label>
              <input type="number"
                     name="weight"
                     class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                     placeholder="60"
                     value="{{ patient.weight_kg if patient and patient.weight_kg else '' }}">
            </div>
            <div>
              <label class="block text-slate-700 font-medium mb-2">‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß (‡∏ã‡∏°.)</label>
              <input type="number"
                     name="waist"
                     class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                     placeholder="85"
                     value="{{ patient.waist_cm if patient and patient.waist_cm else '' }}">
            </div>
          </div>

          <!-- ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß/‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ column ‡πÉ‡∏ô DB ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà bind) -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
   <div>
    <label class="block text-slate-700 font-medium mb-2">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>

    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
      <label class="inline-flex items-center gap-2">
        <input type="checkbox"
               name="disease"
               value="‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô"
               class="accent-blue-600"
               {% if disease_list and '‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô' in disease_list %}checked{% endif %}>
        ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô
      </label>

      <label class="inline-flex items-center gap-2">
        <input type="checkbox"
               name="disease"
               value="‡πÑ‡∏ï"
               class="accent-blue-600"
               {% if disease_list and '‡πÑ‡∏ï' in disease_list %}checked{% endif %}>
        ‡πÑ‡∏ï
      </label>

      <label class="inline-flex items-center gap-2">
        <input type="checkbox"
               name="disease"
               value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á"
               class="accent-blue-600"
               {% if disease_list and '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á' in disease_list %}checked{% endif %}>
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á
      </label>

      <label class="inline-flex items-center gap-2">
        <input type="checkbox"
               name="disease"
               value="‡∏´‡∏±‡∏ß‡πÉ‡∏à"
               class="accent-blue-600"
               {% if disease_list and '‡∏´‡∏±‡∏ß‡πÉ‡∏à' in disease_list %}checked{% endif %}>
        ‡∏´‡∏±‡∏ß‡πÉ‡∏à
      </label>

      <label class="inline-flex items-center gap-2">
        <input type="checkbox"
               name="disease"
               value="‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á"
               class="accent-blue-600"
               {% if disease_list and '‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á' in disease_list %}checked{% endif %}>
        ‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á
      </label>
    </div>
  </div>

  <!-- ‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ -->
  <div>
    <label class="block text-slate-700 font-medium mb-2">‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)</label>
    <input type="text"
           name="disease_other"
           class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
           placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á ‡∏Ø‡∏•‡∏Ø"
           value="{{ disease_other or '' }}">
  </div>
</div>


      <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô -->
<div class="rounded-[26px] bg-white/95 backdrop-blur shadow-xl border border-slate-100 overflow-hidden">
  <div class="px-6 py-4 flex items-center gap-3 bg-emerald-50">
    <div class="w-10 h-10 rounded-xl bg-emerald-200 text-emerald-700 grid place-items-center">
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
        <path d="M12 20l9-16H3l9 16z" />
      </svg>
    </div>
    <div class="font-semibold">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>
  </div>

  <div class="p-6 md:p-8 space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- ‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô -->
      <div>
        <div class="font-medium mb-2">‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô</div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <div class="text-sm text-slate-600 mb-1">‡∏´‡∏π‡∏ã‡πâ‡∏≤‡∏¢</div>
            <label class="inline-flex items-center gap-2 mr-4">
              <input type="radio"
                     name="hearing_left"
                     value="normal"
                     class="accent-blue-600"
                     {% if patient and patient.hearing_left == 'normal' %}checked{% endif %}>
              ‡∏õ‡∏Å‡∏ï‡∏¥
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio"
                     name="hearing_left"
                     value="abnormal"
                     class="accent-blue-600"
                     {% if patient and patient.hearing_left == 'abnormal' %}checked{% endif %}>
              ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
            </label>
          </div>

          <div>
            <div class="text-sm text-slate-600 mb-1">‡∏´‡∏π‡∏Ç‡∏ß‡∏≤</div>
            <label class="inline-flex items-center gap-2 mr-4">
              <input type="radio"
                     name="hearing_right"
                     value="normal"
                     class="accent-blue-600"
                     {% if patient and patient.hearing_right == 'normal' %}checked{% endif %}>
              ‡∏õ‡∏Å‡∏ï‡∏¥
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio"
                     name="hearing_right"
                     value="abnormal"
                     class="accent-blue-600"
                     {% if patient and patient.hearing_right == 'abnormal' %}checked{% endif %}>
              ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
            </label>
          </div>
        </div>
      </div>

      <!-- ‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô -->
      <div>
        <div class="font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô (Snellen chart)</div>
        <textarea name="vision_snellen"
                  class="w-full rounded-2xl border border-slate-200 px-4 py-3 outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-300"
                  placeholder="‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏≤‡∏Ç‡∏ß‡∏≤ 6/6 ‡∏ï‡∏≤‡∏ã‡πâ‡∏≤‡∏¢ 6/9"
                  rows="3">{{ patient.vision_snellen if patient and patient.vision_snellen else '' }}</textarea>
      </div>

    </div>
  </div>
</div>


      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏á -->
      <div class="px-6 md:px-8 pb-6 mt-8 flex items-center justify-between">
        <div class="flex flex-wrap gap-3">
          <a href="{{ url_for('dashboard') }}"
             class="px-6 py-2 bg-gray-200 text-slate-700 rounded-2xl shadow hover:bg-gray-300 transition">
            ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
          </a>
        </div>

        <button type="submit"
                class="rounded-2xl px-6 py-3 font-semibold text-white
                       bg-gradient-to-r from-blue-500 to-blue-600 shadow-lg hover:opacity-95">
          ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ >
        </button>
      </div>

    </form>
  </div>
</div>

<!-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏ + ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏û.‡∏®. -> ‡∏Ñ.‡∏®. -->
<script>
  const dob   = document.getElementById("dob");
  const dobAd = document.getElementById("dob_ad");
  const age   = document.getElementById("age");

  function updateAgeAndBirthdate() {
    if (!dob) return;
    const v = dob.value.trim();
    if (!v.includes("/")) return;

    const parts = v.split("/");
    if (parts.length !== 3) return;

    let [d, m, yBE] = parts.map(n => parseInt(n, 10));

    const currentYearBE = new Date().getFullYear() + 543;
    if (yBE < 2400 || yBE > currentYearBE) {
      age.value = "";
      dobAd.value = "";
      return;
    }

    const yAD  = yBE - 543;
    const adStr = `${yAD}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    dobAd.value = adStr;

    const today = new Date();
    const birth = new Date(adStr);

    let a = today.getFullYear() - birth.getFullYear();
    const mDiff = today.getMonth() - birth.getMonth();
    if (mDiff < 0 || (mDiff === 0 && today.getDate() < birth.getDate())) {
      a--;
    }
    if (a < 0) a = 0;

    age.value = a;
  }

  if (dob) {
    dob.addEventListener("change", updateAgeAndBirthdate);
    dob.addEventListener("input",  updateAgeAndBirthdate);
  }
</script>

{% endblock %}
